<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Pizza do Chef Gaetano</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(to right, #009246 33.33%, #FFFFFF 33.33%, #FFFFFF 66.66%, #CE2B37 66.66%);
        }
        canvas {
            background-color: rgba(255, 255, 255, 0.7);
            border: 2px solid black;
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <audio id="pickupSound" src="data:audio/wav;base64,..."></audio>
    <audio id="gameOverSound" src="data:audio/wav;base64,..."></audio>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const pickupSound = document.getElementById('pickupSound');
        const gameOverSound = document.getElementById('gameOverSound');

        let player = [{ x: 10, y: 10 }];
        let pizza = { x: 15, y: 15 };
        let dx = 0;
        let dy = 0;
        let score = 0;
        let highScore = 0;
        let gameSpeed = 230; // Ridotta del 15% rispetto alla precedente
        let gameLoop;
        let isPaused = false;
        let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        function drawGame() {
            if (isPaused) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Disegna il giocatore
            ctx.font = '20px Arial';
            player.forEach((segment) => {
                ctx.fillText('üë®‚Äçüç≥', segment.x * 20, segment.y * 20 + 20);
            });

            // Disegna la pizza
            ctx.fillText('üçï', pizza.x * 20, pizza.y * 20 + 20);

            // Disegna il punteggio
            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.fillText(`Pontua√ß√£o: ${score} | Recorde: ${highScore}`, 10, 30);

            movePlayer();
            checkCollision();
            checkDifficulty();
        }

        function movePlayer() {
            let head = { x: player[0].x + dx, y: player[0].y + dy };

            // Controlla se il giocatore ha toccato i bordi
            if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20) {
                gameOver();
                return;
            }

            player.unshift(head);
            if (player.length > Math.floor(score / 20) + 1) {
                player.pop();
            }
        }

        function checkCollision() {
            if (player[0].x === pizza.x && player[0].y === pizza.y) {
                score++;
                if (score > highScore) {
                    highScore = score;
                }
                generatePizza();
                pickupSound.play();
                if (score % 10 === 0) {
                    showPromoMessage();
                }
            }
        }

        function generatePizza() {
            pizza.x = Math.floor(Math.random() * 18) + 1;
            pizza.y = Math.floor(Math.random() * 18) + 1;
        }

        function checkDifficulty() {
            if (score === 20) {
                gameSpeed = Math.floor(gameSpeed * 0.8);
            } else if (score === 40) {
                gameSpeed = Math.floor(gameSpeed * 0.8);
            }
            clearInterval(gameLoop);
            gameLoop = setInterval(drawGame, gameSpeed);
        }

        function gameOver() {
            clearInterval(gameLoop);
            gameOverSound.play();
            alert(`Fim de jogo! Sua pontua√ß√£o: ${score}`);
            player = [{ x: 10, y: 10 }];
            dx = 0;
            dy = 0;
            score = 0;
            gameSpeed = 230; // Ripristina la velocit√† iniziale
            isPaused = false;
            showInstructions();
            gameLoop = setInterval(drawGame, gameSpeed);
        }

        function showPromoMessage() {
            isPaused = true;
            const message = score % 20 === 0 ? "Chef Gaetano" : "Pizzaria Bella Napoli";
            alert(message);
            setTimeout(() => {
                isPaused = false;
            }, 2000);
        }

        function handleKeyDown(e) {
            switch(e.key) {
                case 'ArrowLeft': dx = -1; dy = 0; break;
                case 'ArrowRight': dx = 1; dy = 0; break;
                case 'ArrowUp': dx = 0; dy = -1; break;
                case 'ArrowDown': dx = 0; dy = 1; break;
            }
        }

        canvas.addEventListener('touchstart', handleTouchStart, false);
        canvas.addEventListener('touchmove', handleTouchMove, false);
        document.addEventListener('keydown', handleKeyDown);

        let xDown = null;
        let yDown = null;

        function handleTouchStart(evt) {
            const firstTouch = evt.touches[0];
            xDown = firstTouch.clientX;
            yDown = firstTouch.clientY;
        }

        function handleTouchMove(evt) {
            if (!xDown || !yDown) return;

            const xUp = evt.touches[0].clientX;
            const yUp = evt.touches[0].clientY;
            const xDiff = xDown - xUp;
            const yDiff = yDown - yUp;

            if (Math.abs(xDiff) > Math.abs(yDiff)) {
                dx = xDiff > 0 ? -1 : 1;
                dy = 0;
            } else {
                dx = 0;
                dy = yDiff > 0 ? -1 : 1;
            }

            xDown = null;
            yDown = null;
        }

        function showInstructions() {
            const instructions = `
            Como jogar:
            - Deslize na tela ou use as setas do teclado para mover o chap√©u do chef.
            - Colete as fatias de pizza para marcar pontos.
            - A velocidade aumenta a cada 20 pontos.
            - Tente bater seu pr√≥prio recorde!
            
            Divirta-se na Pizzaria Bella Napoli do Chef Gaetano!
            `;
            alert(instructions);
        }

        showInstructions();
        gameLoop = setInterval(drawGame, gameSpeed);
    </script>
</body>
</html>
